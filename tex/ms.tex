\documentclass[modern]{aastex62}

% Load the corTeX style definitions
\input{cortex}

% Bibliography stuff
\bibliographystyle{aasjournal}

% Begin!
\begin{document}

% Title
\title{Doppler Imaging Fun}

% Author list
\author[0000-0002-0296-3826]{Rodrigo Luger}
\email{rluger@flatironinstitute.org}
\affil{Center~for~Computational~Astrophysics, Flatiron~Institute, New~York, NY}
%
\author{Megan Bedell}
\affil{Center~for~Computational~Astrophysics, Flatiron~Institute, New~York, NY}
%
\author{Probably David W. Hogg}
\affil{Center~for~Computational~Astrophysics, Flatiron~Institute, New~York, NY}

%
\section{Introduction}
%
Check out \citet{Luger2019} and \citet{Bedell2019} and stuff.

%
\section{Uniform surfaces}
\label{sec:uniform surfaces}
%
Let $I(\xi, x, y)$ be the Doppler-shifted intensity observed at log wavelength 
$\xi \equiv \ln\lambda$ at sky-projected Cartesian position $x, y$ on the 
surface of the star. We may express it as
%
\begin{align}
    \label{eq:IntensityUnif}
    I(\xi, x, y) &= I_0(\xi_0)
\end{align}
%
where $I_0$ is the (spatially uniform) spectrum in the original, unshifted 
frame and 
%
\begin{align}
    \label{eq:xi0}
    \xi_0 &= \xi + \alpha(x, y)
\end{align}
%
is the log wavelength in the unshifted frame. The quantity $\alpha$ is
computed from the formula for the Doppler shift and is equal to
%
\begin{align}
    \alpha(x, y) 
        &=
        \frac{1}{2}\ln\left( 
            \frac{1 - \beta}{1 + \beta} 
        \right) 
        %\nonumber \\
        %&\approx
        %\ln(1 - \beta)
\end{align}
%
where $\beta = v(x, y) / c$ is the ratio of the 
radial velocity at a point on 
the surface of the star to the speed of light. In keeping with the 
literature, we assume that positive values of $v$ correspond to redshifts.

A common approach to computing the Doppler-shifted spectrum is to
evaluate the spectrum at the rest frame wavelength (Equation~\ref{eq:xi0})
and interpolate back to the grid in $\xi$. This is practical when
computing the spectrum at a single \emph{point} on the surface, but not
ideal when one is interested in the \emph{integral} over the entire
surface, which is typically what we can observe. The standard approach is
to discretize the surface of the star with a fine grid, evaluate the
Doppler-shifted spectrum in each cell, and sum over the spatial axes
to approximate the integral. Depending on the resolution of the grid,
this is either numerically inaccurate or computationally inefficient 
(and often both).

\subsection{Linearizing the Doppler operator}
\label{sec:taylor}
%
One way to improve upon this could be to linearize the Doppler operator via
a Taylor expansion in $\alpha$ about $\alpha=0$:
%
\begin{align}
    \label{eq:TaylorUnifExplicit}
    I(\xi, x, y) 
        &=
        I_0(\xi_0) \Bigg|_{\alpha=0}
        + 
        \frac{\mathrm{d}I_0(\xi_0)}{\mathrm{d}\alpha} \Bigg|_{\alpha=0} 
            \Delta\alpha(x, y)
        + 
        \frac{1}{2}\frac{\mathrm{d}^2I_0(\xi_0)}{\mathrm{d}\alpha^2} 
            \Bigg|_{\alpha=0} \Delta\alpha(x, y)^2
        +
        ... 
\end{align}
%
Since the dependence of Equation~(\ref{eq:xi0}) on $\alpha$ is trivial,
the derivatives of the spectrum $I_0(\xi_0)$ with respect to
$\alpha$ are simply
%
\begin{align}
    \frac{\mathrm{d}^nI_0(\xi_0)}{\mathrm{d}\alpha^n} &=
    \dfrac{\mathrm{d}^nI_0(\xi_0)}{\mathrm{d}\xi_0^n} \quad.
\end{align}
%
Given this result, and noting that $\xi_0 = \xi$ when $\alpha = 0$,
we may re-write Equation~(\ref{eq:TaylorUnifExplicit}) as
%
\begin{proof}{Taylor}
    \label{eq:TaylorUnifSum}
    I(\xi, x, y) 
        &=
        I_0(\xi)
        +
        \sum_{n=1}^\infty
            \frac{1}{n!}
            \frac{\mathrm{d}^nI_0(\xi)}{\mathrm{d}\xi^n}
            \Delta\alpha(x, y)^n
\end{proof}
%
The utility of this expression is that the spatial dependence of the spectrum
is now entirely encoded in the terms $\Delta\alpha(x, y)^n$, which is
\emph{independent of wavelength}. The surface integral of 
Equation~(\ref{eq:TaylorUnifSum}) is therefore far easier to compute, since
it is the integral of a \emph{scalar} function that could even be approximated
analytically for some choice of the velocity field $\alpha(x, y)$.

However, Equation~(\ref{eq:TaylorUnifSum}) is impractical for
two reasons. First, it requires knowledge of high order derivatives of the 
spectrum, which may not always be easy or convenient to compute. Second, and
more important, the series expansion is typically extremely slow to converge
and is therefore only practically useful in the limit that the Doppler shift
is much smaller than the typical width of a spectral line; see the notebook
link next to Equation~(\ref{eq:TaylorUnifSum}) for an example.

\subsection{Taking the Fourier transform}
\label{sec:fourier}
%
Recall the definition of the Fourier transform of a function $f(\xi)$,
%
\begin{align}
    \label{eq:FT}
    \mathcal{F}\Big[f(\xi)\Big](k) 
    &\equiv
    \int_{-\infty}^\infty
        f(\xi)
        \mathrm{e}^{-2\pi i k \xi} \mathrm{d}\xi
    \nonumber \\
    &=
    \hat{f}(k)
    \quad ,
\end{align}
%
and the corresponding inverse Fourier transform,
%
\begin{align}
    \label{eq:IFT}
    \mathcal{F}^{-1}\Big[\hat{f}(k)\Big](\xi) 
    &\equiv
    \int_{-\infty}^\infty
        \hat{f}(k)
        \mathrm{e}^{2\pi i k \xi} \mathrm{d}k
    \nonumber \\
    &=
    f(\xi)
    \quad .
\end{align}
%
Consider what happens when we take the
Fourier transform of the spectrum $I(\xi, x, y)$ to obtain
a function $\hat{I}(k, x, y)$. A useful property of the
Fourier transform is that a translation of $I(\xi, x, y)$ by
an amount $\Delta\xi$ corresponds to a linear scaling
of $\hat{I}(k, x, y)$ by an amount $\mathrm{e}^{-2\pi i k \Delta\xi}$
\citep[e.g.,][]{Schoenstadt2006}.
Specifically, if the Doppler-shifted spectrum 
is given by
%
\begin{align}
    I(\xi, x, y) &= I_0\big(\xi + \alpha(x, y)\big) \quad,
\end{align}
%
its Fourier transform is equal to 
%
\begin{align}
    \label{eq:translation}
    \hat{I}(\xi, x, y) &= \mathrm{e}^{2\pi i k \alpha(x, y)}\hat{I_0}(k) \quad,
\end{align}
%
where $\hat{I_0}(k) \equiv \mathcal{F}\left[ I_0(\xi) \right]$.
%
Much as in \S\ref{sec:taylor}, we have de-coupled the spatial and spectral
terms, but this time without the need of a Taylor expansion. To obtain
the Fourier transform of the disk-integrated spectrum, $\hat{S}$, we may 
integrate Equation~(\ref{eq:translation})
over the visible disk $\mathcal{S}$ of the star:
%
\begin{align}
    \label{eq:integral_translation}
    \hat{S}(k) 
    &= 
        \hat{I_0}(k)\iint\limits_{\mathcal{S}(x, y)}
        \mathrm{e}^{2\pi i k \alpha(x, y)}
        \mathrm{d}\mathcal{S}(x, y) \nonumber \\
    &=
        \hat{I_0}(k)\iint\limits_{\mathcal{S}(x, y)}
        % MAGIC
        \left( \frac{1 - \beta(x, y)}{1 + \beta(x, y)} \right) ^ {\pi i k}
        % MAGIC
        \mathrm{d}\mathcal{S}(x, y) \nonumber \\
    &=
        \hat{I_0}(k) \hat{J}(k)
\end{align}
%
where we define
%
\begin{align}
    \label{eq:Jhat}
    \hat{J}(k) \equiv 
        \iint\limits_{\mathcal{S}(x, y)}
        % MAGIC
        \left( \frac{1 - \beta(x, y)}{1 + \beta(x, y)} \right) ^ {\pi i k}
        % MAGIC
        \mathrm{d}\mathcal{S}(x, y)
\end{align}
%
to be the surface integral of the velocity field in Fourier space.
The disk-integrated spectrum is then obtained by applying the inverse Fourier
transform:
%
\begin{align}
    S(\xi) &= \mathcal{F}^{-1}\Big[ \hat{S}(k) \Big] \nonumber \\
           \label{eq:S}
           &= \mathcal{F}^{-1}\Big[ \hat{I_0}(k) \hat{J}(k) \Big] \\
           \label{eq:S_conv}
           &= I_0(\xi) \circ J(\xi)
\end{align}
%
where the last step follows from the convolution theorem, 
with $J(\xi) \equiv \mathcal{F}^{-1}\left[ \hat{J}(k) \right]$ and $\circ$
denoting the convolution operator.

\subsubsection{Rotational line broadening}
\label{sec:line_broadening}
%
As an example, consider the case of an unocculted, uniform star of unit
radius with negligible limb darkening, rigidly rotating about an axis 
perpendicular to the line of sight with equatorial angular velocity 
$\omega_\mathrm{eq}$. The velocity profile everywhere on the surface is
%
\begin{align}
    \beta(x, y) &= \frac{\omega_\mathrm{eq}}{c}x \nonumber\\
                &\equiv \beta_\mathrm{eq} x 
                \quad .
\end{align}
%
The surface integral term may then be computed as
%
\begin{proof}{Fourier}
    \hat{J}(k) 
    &=
        \int_{-1}^{1}
        \int_{-\sqrt{1 - x^2}}^{\sqrt{1 - x^2}}
        % MAGIC
        \left( 
            \frac{1 - \beta_\mathrm{eq} x}
                 {1 + \beta_\mathrm{eq} x} 
        \right) ^ {\pi i k}
        % MAGIC
        \mathrm{d}y
        \,
        \mathrm{d}x
        \nonumber \\[0.75em]
    &\approx
        \int_{-1}^{1}
        \int_{-\sqrt{1 - x^2}}^{\sqrt{1 - x^2}}
        % MAGIC
        \left( 
            1 - \beta_\mathrm{eq} x 
        \right) ^ {2\pi i k}
        % MAGIC
        \mathrm{d}y
        \,
        \mathrm{d}x
        \nonumber \\[0.75em]
    &=
        \pi \, _{2}F_{1}
            \left(
                -\pi i k, \, 
                \frac{1}{2} - \pi i k; \,
                2; \,
                \beta_\mathrm{eq}^2
            \right)
    \quad ,
\end{proof}
%
where $_{2}F_{1}$ is the hypergeometric function. Note that
the approximation in the second line is valid when $\beta \ll 1$
(i.e., the non-relativistic case).

The equation for the observed disk-integrated spectrum is therefore
%
\begin{proof}{Fourier}
    \label{eq:uniform}
    S(\xi) &= 
    \pi
    \mathcal{F}^{-1}
    \Big[
        \mathcal{F}(I_0)
        \,
        _{2}F_{1}
        \left(
            -\pi i k, \, 
            \frac{1}{2} - \pi i k; \,
            2; \,
            \beta_\mathrm{eq}^2
        \right)
    \Big]
\end{proof}
%
Figure~\ref{fig:uniform} shows an example application of this equation
to the case of rotational broadening of a Gaussian absorption line.

\begin{figure}[p!]
    \centering
    \includegraphics[width=0.9\textwidth]{figures/uniform.pdf}
    \oscaption{uniform}{%
        Application of Equation~(\ref{eq:uniform}) to computation
        of rotational line broadening of a Gaussian absorption line.
        \emph{Top:} A line centered at $\lambda = 1.00$ with 
        standard deviation $\sigma = 0.01$ (dashed black curve) is 
        redshifted by a Doppler parameter $\beta = 0.05$. The
        blue curve is the result obtained by interpolation, while
        the dashed orange curve is the result obtained by scaling
        the Fourier transform of the line according to
        Equation~(\ref{eq:translation}) and then applying the inverse
        Fourier transform.
        \emph{Bottom:} The same line profile is now integrated over
        the visible disk of a uniform, rigidly rotating star with
        $\beta_\mathrm{eq} = 0.05$ numerically (blue curve) and via
        the Fourier method (Equation~\ref{eq:uniform}). In both cases,
        the results agree to within the accuracy of the numerical
        approaches.
        \label{fig:uniform}
    }
\end{figure}

\subsubsection{Rossiter-McLaughlin Effect}
\label{sec:rmeffect}
%
Consider now the case where the integral is taken over only a portion
of the stellar disk, as in the case of an occultation by an orbiting planet
(or stellar companion). We can make use of Equation~(\ref{eq:S}) to
compute the time evolution of the observed spectrum during a transit
or occultation, i.e., the Rossiter-McLaughlin effect.
%
Working again in the non-relativistic limit, we may approximate
Equation~(\ref{eq:Jhat}) as
%
\begin{align}
    \label{eq:Jhat_approx}
    \hat{J}(k) \approx
        \iint\limits_{\mathcal{S}(x, y)}
        % MAGIC
        \left( 1 - \beta(x, y) \right) ^ {2\pi i k}
        % MAGIC
        \mathrm{d}\mathcal{S}(x, y)
\end{align}
%
We can further decompose this into its real and imaginary parts,
keeping only terms up to linear order in $\beta_\mathrm{eq}$:
%
\begin{align}
    \label{eq:Jhat_approx_re}
    \mathrm{Re}\left[\hat{J}(k)\right] 
    &\approx
        \iint\limits_{\mathcal{S}(x, y)}
        % MAGIC
        \cos \Big[ 2\pi k \ln\big(1 - \beta(x, y)\big) \Big]
        % MAGIC
        \mathrm{d}\mathcal{S}(x, y)
    \nonumber \\
    &\approx
        \iint\limits_{\mathcal{S}(x, y)}
        \mathrm{d}\mathcal{S}(x, y)
\end{align}
%
and
%
\begin{align}
    \label{eq:Jhat_approx_im}
    \mathrm{Im}\left[\hat{J}(k)\right] 
    &\approx
        \iint\limits_{\mathcal{S}(x, y)}
        % MAGIC
        \sin \Big( 2\pi k \ln\big(1 - \beta(x, y)\big) \Big)
        % MAGIC
        \mathrm{d}\mathcal{S}(x, y)
    \nonumber \\
    &\approx
        -2\pi k
        \iint\limits_{\mathcal{S}(x, y)}
        % MAGIC
        \beta(x, y)
        % MAGIC
        \mathrm{d}\mathcal{S}(x, y)
        \quad .
\end{align}
%
\cite{Luger2019} developed an analytic formalism to compute these 
integrals, provided $\beta(x, y)$ can be expressed in terms of
spherical harmonics. We will see in the following section that
$\beta(x, y)$ can be expressed exactly as the sum of
spherical harmonics of low degree in the case of a 
star with arbitrary inclination and obliquity and linear
differential rotation. For now, however, let us consider again
the simple case of a rigidly rotating star with rotation axis
perpendicular to the line of sight. In this case,
%
\begin{align}
    \mathrm{Re}\left[\hat{J}(k)\right] 
    &\approx \iint\limits_{\mathcal{S}(x, y)}\mathrm{d}\mathcal{S}(x, y)
    \nonumber \\
    &= \mathbf{s}_0(x_o, y_o, r_o)
\end{align}
%
and
%
\begin{align}
    \mathrm{Im}\left[\hat{J}(k)\right] 
    &\approx 
    -2\pi k \beta_\mathrm{eq}
    \iint\limits_{\mathcal{S}(x, y)}
    x
    \mathrm{d}\mathcal{S}(x, y)
    \nonumber \\
    &= -\pi k \beta_\mathrm{eq} \mathbf{s}_1(x_o, y_o, r_o)
\end{align}
%

% Bibliography
\bibliography{bib}

\end{document}
